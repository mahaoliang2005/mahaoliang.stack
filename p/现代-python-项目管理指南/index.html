<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='在很长一段时间里，我管理 Python 项目的方式堪称“原始”。每当项目需要新的依赖，我便会在 README.md 文件里手动记上一笔，提醒自己需要 pip install 哪些库。这种“刀耕火种'>
<title>现代 Python 项目管理指南</title>

<link rel='canonical' href='https://mahaoliang.tech/p/%E7%8E%B0%E4%BB%A3-python-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97/'>

<link rel="stylesheet" href="/scss/style.min.770ba8406666c7454bd4815f8d62ef6807a898b1a3313aa1ebcc12add3f80b36.css"><meta property='og:title' content='现代 Python 项目管理指南'>
<meta property='og:description' content='在很长一段时间里，我管理 Python 项目的方式堪称“原始”。每当项目需要新的依赖，我便会在 README.md 文件里手动记上一笔，提醒自己需要 pip install 哪些库。这种“刀耕火种'>
<meta property='og:url' content='https://mahaoliang.tech/p/%E7%8E%B0%E4%BB%A3-python-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97/'>
<meta property='og:site_name' content='mahaoliang.tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='python' /><meta property='article:published_time' content='2025-07-23T18:39:02&#43;08:00'/><meta property='article:modified_time' content='2025-07-23T18:39:02&#43;08:00'/>
<meta name="twitter:title" content="现代 Python 项目管理指南">
<meta name="twitter:description" content="在很长一段时间里，我管理 Python 项目的方式堪称“原始”。每当项目需要新的依赖，我便会在 README.md 文件里手动记上一笔，提醒自己需要 pip install 哪些库。这种“刀耕火种">
    <link rel="shortcut icon" href="/favicon.png" />

  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-VWTLVW9ZPS"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-VWTLVW9ZPS');
        }
      </script>
    
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/mahaoliang_hua507f931c6be309c8566e66a5c545e52_175025_300x0_resize_q75_box.jpg" width="300"
                            height="308" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">mahaoliang.tech</a></h1>
            <h2 class="site-description">让花成花，让树成树</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/391943000'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Bilibili</title><path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:me@mahaoliang.tech'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.facebook.com/mahaoliang'
                        target="_blank"
                        title="facebook"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-facebook" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://gitee.com/mahaoliang'
                        target="_blank"
                        title="Gitee"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" encoding="UTF-8"?>
<svg width="72px" height="72px" viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>logo_gitee_g_red@1x</title>
    <g id="LOGO" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Artboard-7" transform="translate(-192.000000, -115.000000)" fill="#C71D23">
            <path d="M228,115 C247.882251,115 264,131.117749 264,151 C264,170.882251 247.882251,187 228,187 C208.117749,187 192,170.882251 192,151 C192,131.117749 208.117749,115 228,115 Z M246.223335,131 C246.222967,131 246.2226,131 246.222232,131.001102 L221.33326,131.001102 C213.969504,131.001102 208,136.970606 208,144.334362 L208,169.222232 C208,170.204066 208.795934,171 209.777768,171 L236.000329,171 C242.627564,171 248,165.627564 248,159.000329 L248,148.778425 C248,147.796591 247.204066,147.000657 246.222232,147.000657 L225.7779,147.000657 C224.796248,147.001123 224.000389,147.796773 223.999667,148.778425 L223.998503,153.222667 C223.997802,154.155409 224.715909,154.920565 225.629522,154.994969 L225.775805,155.00042 L225.775805,155.00042 L238.222276,155.000317 C239.155019,155.000295 239.919992,155.718618 239.994164,156.63225 L240.000044,156.77807 L240.000044,156.77807 L240.000044,157.666909 C240.000044,160.612411 237.612243,163.000213 234.66674,163.000213 L217.776621,163.000213 C216.794928,163.000164 215.999101,162.204358 215.999025,161.222665 L215.998559,144.334184 C215.998337,141.462319 218.268172,139.120556 221.111731,139.005187 L221.331716,139.00088 L221.331716,139.00088 L246.21727,139.00088 C247.198674,138.999777 247.994429,138.204515 247.996141,137.223112 L247.998897,132.77887 C248.000609,131.797037 247.205169,131.000609 246.223335,131 Z" id="logo_gitee_g_red"></path>
        </g>
    </g>
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/mahaoliang2005'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/TTBJDTJZJ'
                        target="_blank"
                        title="telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://mahaoliang.tech/" selected>中文</option>
                        
                            <option value="https://mahaoliang.tech/en/" >English</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>暗色模式</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#传统方式venv--requirementstxt">传统方式：<code>venv</code> + <code>requirements.txt</code></a>
      <ol>
        <li><a href="#环境隔离与依赖列表">环境隔离与依赖列表</a></li>
        <li><a href="#传统方式的隐患">传统方式的隐患</a></li>
      </ol>
    </li>
    <li><a href="#现代篇章pyprojecttoml">现代篇章：<code>pyproject.toml</code></a>
      <ol>
        <li><a href="#标准的诞生-pep-518--621">标准的诞生 (PEP 518 &amp; 621)</a></li>
        <li><a href="#声明式依赖管理">声明式依赖管理</a></li>
        <li><a href="#pip-install--的背后原理"><code>pip install .</code> 的背后原理</a></li>
        <li><a href="#可编辑模式-pip-install--e-">可编辑模式 (<code>pip install -e .</code>)</a></li>
      </ol>
    </li>
    <li><a href="#解析splitter-项目的-pyprojecttoml">解析<code>splitter</code> 项目的 <code>pyproject.toml</code></a>
      <ol>
        <li><a href="#build-system"><code>[build-system]</code></a></li>
        <li><a href="#project"><code>[project]</code></a></li>
        <li><a href="#projectscripts"><code>[project.scripts]</code></a></li>
        <li><a href="#toolsetuptoolspackagesfind"><code>[tool.setuptools.packages.find]</code></a></li>
      </ol>
    </li>
    <li><a href="#poetry-uv-pdm-等高级管理工具">Poetry, UV, PDM 等高级管理工具</a>
      <ol>
        <li><a href="#新一代高级管理工具">新一代高级管理工具</a></li>
        <li><a href="#以-uv-为例的现代化工作流">以 <code>uv</code> 为例的现代化工作流</a></li>
      </ol>
    </li>
    <li><a href="#构建你的现代化-python-工作流">构建你的现代化 Python 工作流</a></li>
    <li><a href="#写在最后">写在最后</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" >
                Tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E7%8E%B0%E4%BB%A3-python-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97/">现代 Python 项目管理指南</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-07-23</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 13 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>在很长一段时间里，我管理 Python 项目的方式堪称“原始”。每当项目需要新的依赖，我便会在 <code>README.md</code> 文件里手动记上一笔，提醒自己需要 <code>pip install</code> 哪些库。这种“刀耕火种”的模式，对于个人写的一些小脚本尚可应付，但当项目变得复杂，或是需要与他人协作时，其脆弱和低效便暴露无遗。</p>
<p>真正的转折点发生在今年夏天。我有幸参与了<a class="link" href="https://summer-ospp.ac.cn/"  target="_blank" rel="noopener"
    >开源之夏</a>，并成功中选了 openEuler 社区的 <a class="link" href="https://summer-ospp.ac.cn/org/prodetail/25b970448"  target="_blank" rel="noopener"
    >面向 openEuler distroless 镜像的 SDF 自动生成工具开发</a> 项目，为 <a class="link" href="https://gitee.com/openeuler/splitter"  target="_blank" rel="noopener"
    >splitter</a> 这个工具贡献代码。当我满怀激情地克隆代码库，准备大展拳脚时，一个文件赫然出现在我的眼前：<code>pyproject.toml</code>。这个我以往只是模糊听闻过的文件，在这里却是项目配置的核心。</p>
<p>这次经历像一扇窗，让我窥见了现代 Python 项目管理的全新世界。于是，我将这段学习和探索的经历整理成文。</p>
<h2 id="传统方式venv--requirementstxt">传统方式：<code>venv</code> + <code>requirements.txt</code></h2>
<p>以 <code>venv</code> 和 <code>requirements.txt</code> 为核心的工作流，是 Python 社区在告别全局安装、走向规范化管理过程中迈出的重要一步。</p>
<h3 id="环境隔离与依赖列表">环境隔离与依赖列表</h3>
<p><strong>虚拟环境 (<code>venv</code>)</strong></p>
<p>如果你经历过在系统全局 Python 环境中安装各种包的混乱时期，你一定对 <strong>“依赖地狱” (dependency hell)</strong> 这个词深有体会。项目 A 需要 <code>requests==2.20.0</code>，而项目 B 依赖的另一个库却需要 <code>requests==2.28.0</code>，它们在全局环境中相互冲突，让开发者头痛不已。</p>
<p><code>venv</code> 的出现正是为了解决这个问题。它允许我们为每个项目创建一个独立的、与全局环境隔离的 Python 工作空间。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 在项目根目录下，创建一个名为 .venv 的虚拟环境</span>
</span></span><span class="line"><span class="cl">python3 -m venv .venv
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个命令会创建一个 <code>.venv</code> 文件夹，里面包含了项目所需的一个迷你的 Python 运行环境。要使用它，我们需要先“激活”：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">source</span> .venv/bin/activate
</span></span></code></pre></td></tr></table>
</div>
</div><p>激活后，你会发现命令行提示符前面多了 <code>(.venv)</code> 的标识。此时，所有 <code>pip</code> 的安装、卸载操作都将被限制在这个独立的虚拟环境中，再也不会污染全局环境了。</p>
<p><strong>依赖文件 (<code>requirements.txt</code>)</strong></p>
<p>环境隔离了，但如何与他人协作呢？我们总不能把整个 <code>.venv</code> 文件夹都发给别人吧。这时，<code>requirements.txt</code> 就登上了历史舞台。它的作用，就是一份项目的“依赖清单”。</p>
<p>最常见的生成方式是使用 <code>pip freeze</code> 命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 将当前虚拟环境中所有已安装的包及其精确版本号导出</span>
</span></span><span class="line"><span class="cl">pip freeze &gt; requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样，你的项目协作者或者部署服务器，只需要拿到你的代码和这个 <code>requirements.txt</code> 文件，然后执行一条简单的命令，就可以复现出一个一模一样的运行环境：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 从 requirements.txt 文件中安装所有指定的依赖</span>
</span></span><span class="line"><span class="cl">pip install -r requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>这套组合拳极大地提升了 Python 项目的规范性和可复现性，至今仍有大量项目在使用。</p>
<h3 id="传统方式的隐患">传统方式的隐患</h3>
<p>尽管 <code>venv</code> + <code>requirements.txt</code> 解决了大问题，但随着项目复杂度的提升，其内在的缺陷也逐渐暴露出来。</p>
<p><strong>依赖混淆</strong></p>
<p>最大的问题在于 <code>pip freeze</code> 的工作方式。它像一个不加分辨的记录员，会把你环境中<strong>所有</strong>的包都记录下来。这其中既包含了你为了实现功能而主动安装的<strong>直接依赖</strong>（比如 Web 框架 <code>Flask</code>），也包含了 <code>Flask</code> 运行所必需的<strong>间接依赖</strong>（比如 <code>Werkzeug</code>, <code>Jinja2</code>, <code>click</code> 等）。</p>
<p>最终生成的 <code>requirements.txt</code> 文件看起来会是这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># requirements.txt
</span></span><span class="line"><span class="cl">blinker==1.7.0
</span></span><span class="line"><span class="cl">click==8.1.7
</span></span><span class="line"><span class="cl">Flask==3.0.0
</span></span><span class="line"><span class="cl">itsdangerous==2.1.2
</span></span><span class="line"><span class="cl">Jinja2==3.1.3
</span></span><span class="line"><span class="cl">MarkupSafe==2.1.3
</span></span><span class="line"><span class="cl">Werkzeug==3.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个文件里，你已经分不清谁是谁的依赖了。项目的核心依赖关系被模糊掉了，给后续的维护，比如升级某个特定的核心库，带来了不小的麻烦。</p>
<p><strong>孤儿依赖</strong></p>
<p>另一个令人头疼的问题是“孤儿依赖”。假设你的项目后续不再需要 <code>Flask</code> 了，于是你执行了 <code>pip uninstall flask</code>。<code>pip</code> 很听话地卸载了 <code>Flask</code> 本身，但它当初为了 <code>Flask</code> 而自动安装的 <code>blinker</code>、<code>click</code> 等间接依赖，却被遗留在了环境中，变成了无人认领的“孤儿”。</p>
<p>日积月累，你的虚拟环境会因为这些残留的孤儿依赖而变得越来越臃肿，还可能在未来引发难以预料的依赖冲突。</p>
<p>正是因为这些的缺陷，Python 社区开始探索一种更清晰、更智能的管理方案。这便引出了我们下一章的主角——<code>pyproject.toml</code>。</p>
<h2 id="现代篇章pyprojecttoml">现代篇章：<code>pyproject.toml</code></h2>
<p>面对 <code>requirements.txt</code> 带来的依赖混淆问题，Python 社区需要一个更强大、更规范的解决方案，答案就是 <code>pyproject.toml</code>。</p>
<h3 id="标准的诞生-pep-518--621">标准的诞生 (PEP 518 &amp; 621)</h3>
<p>在 <code>pyproject.toml</code> 成为标准之前，一个 Python 项目的配置信息可谓“四分五裂”。项目元数据可能在 <code>setup.py</code> 或 <code>setup.cfg</code> 里，运行依赖在 <code>requirements.txt</code> 中，测试配置在 <code>tox.ini</code> 或 <code>.coveragerc</code> 里，代码格式化工具 <code>black</code> 和静态检查工具 <code>mypy</code> 又有它们各自的配置文件。这种碎片化的状态让项目维护变得异常繁琐。</p>
<p><a class="link" href="https://peps.python.org/pep-0518/"  target="_blank" rel="noopener"
    >PEP 518</a> 的提出正是为了终结这种乱象。它定义了一个名为 <code>pyproject.toml</code> 的文件格式，旨在成为<strong>所有构建工具的统一配置入口</strong>。随后，<a class="link" href="https://peps.python.org/pep-0621/"  target="_blank" rel="noopener"
    >PEP 621</a> 进一步规范了如何在这个文件中声明项目的核心元数据（如名称、版本、作者和依赖项），使其彻底摆脱了对 <code>setup.py</code> 的依赖。</p>
<p>简单来说，<code>pyproject.toml</code> 的使命就是将所有与项目相关的配置，集中到一个官方认可的、格式统一的文件中。</p>
<h3 id="声明式依赖管理">声明式依赖管理</h3>
<p><code>pyproject.toml</code> 最重要的改进，在于它引入了<strong>声明式依赖管理</strong>。与 <code>pip freeze</code> 那种不加区分的全量记录不同，我们现在只需要在 <code>pyproject.toml</code> 文件中清晰地声明项目的<strong>直接依赖</strong>。</p>
<p>让我们回到上一章的 <code>Flask</code> 项目，它的 <code>pyproject.toml</code> 文件现在会是这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;my-flask-app&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;0.1.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Flask==3.0.0&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>看，多么清爽！<code>dependencies</code> 列表里只有 <code>Flask</code>。我们在这里表达的是<strong>意图</strong>：“我的项目需要 Flask 3.0.0 版本”，而不是 <code>Flask</code> 运行所需要的所有包的冗长列表。至于 <code>Flask</code> 自身依赖的 <code>Werkzeug</code>、<code>Jinja2</code> 等，将由工具在安装时自动去解析和处理。</p>
<p>这种方式将项目的直接依赖与间接依赖彻底分离，让依赖关系一目了然，极大地提升了项目的可读性和可维护性。</p>
<h3 id="pip-install--的背后原理"><code>pip install .</code> 的背后原理</h3>
<p>现在我们有了 <code>pyproject.toml</code>，那么 <code>pip</code> 是如何利用它来安装项目的呢？</p>
<p>当你进入项目根目录，在激活的虚拟环境中执行 <code>pip install .</code> 背后其实发生了两个关键步骤：构建和安装。这个过程不仅仅是复制文件，而是将你的项目变成一个标准的、可分发的 Python 软件包。</p>
<p><strong>第一步：构建 (Build)</strong></p>
<p><code>pip</code> 首先会扮演一个“构建前端”的角色。它会读取 <code>pyproject.toml</code> 文件中的 <code>[build-system]</code> 表，找到指定的“构建后端”（通常是 <code>setuptools</code>）。然后，<code>pip</code> 会指示构建后端，依据当前项目的源代码和 <code>pyproject.toml</code> 中的元数据，构建出一个标准的 Python 软件包，通常是一个 <code>.whl</code> (wheel) 文件。这个 wheel 文件是一个包含了所有代码和元数据的 zip 压缩包，是现代 Python 的标准分发格式。</p>
<p><strong>第二步：安装 (Install)</strong></p>
<p>构建完成后，<code>pip</code> 会接手这个新鲜出炉的 wheel 文件，并将其内容“解压”并安装到你的虚拟环境中。这个过程会产生以下三类核心产物：</p>
<ol>
<li><strong>项目代码与元数据 (Project Code and Metadata)</strong></li>
</ol>
<p>你的项目代码（即所有的 <code>.py</code> 文件和包）会被复制到虚拟环境的 <code>site-packages</code> 目录下（例如 <code>.venv/lib/python3.11/site-packages/my_flask_app</code>）。</p>
<p>同时，一个名为 <code>my_flask_app-0.1.0.dist-info</code> 的元数据目录也会被创建。你可以把它看作是这个软件包的“身份证”，里面包含了从 <code>pyproject.toml</code> 中提取的所有信息，比如项目名、版本、作者以及最重要的——依赖列表。</p>
<ol start="2">
<li><strong>项目依赖 (Project Dependencies)</strong></li>
</ol>
<p><code>pip</code> 会读取上述元数据文件，找到其中声明的 <code>dependencies</code> 列表（例如 <code>&quot;Flask==3.0.0&quot;</code>）。</p>
<p>然后，它会自动下载并安装所有这些直接依赖，以及这些依赖所需要的间接依赖（如 <code>Werkzeug</code>, <code>Jinja2</code> 等），并将它们全部安装到 <code>site-packages</code> 目录中。</p>
<ol start="3">
<li><strong>可执行的命令行脚本 (Executable Command-line Scripts)</strong></li>
</ol>
<p>如果你在文件中定义了 <code>[project.scripts]</code> 部分，像这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">scripts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">my-app</span> <span class="p">=</span> <span class="s2">&#34;my_flask_app.cli:main&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>那么 <code>pip</code> 在安装时，会在虚拟环境的 <code>bin</code> 目录（Windows 上是 <code>Scripts</code>）下创建一个名为 <code>my-app</code> 的可执行文件。</p>
<p>这个文件是一个小小的“启动器”脚本，它的作用是调用当前虚拟环境中的 Python 解释器，并执行你指定的函数 (<code>my_flask_app.cli:main</code>)。</p>
<p>正因为如此，一旦安装完成并激活了虚拟环境，你就可以在任何路径下直接通过命令行运行 <code>my-app</code> 来启动你的应用程序了。</p>
<p>通过这套标准化的流程，<code>pip install .</code> 不仅安装了代码和依赖，还完成了命令行工具的创建，将一个项目从一堆源代码变成了一个功能完整、随时可用的工具。</p>
<h3 id="可编辑模式-pip-install--e-">可编辑模式 (<code>pip install -e .</code>)</h3>
<p><code>pip install .</code> 非常适合用于最终的安装和部署，但在日常开发中，每次修改代码后都重新构建和安装一遍，显然效率太低。为此，<code>pip</code> 提供了一种强大的<strong>可编辑模式 (editable mode)</strong>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install -e .
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>-e</code> 参数是这个模式的关键。执行这条命令后，<code>pip</code> 不会再把你的项目文件复制到 <code>site-packages</code> 目录中，而它会在 <code>site-packages</code> 里创建一个特殊的链接文件（<code>.pth</code> 文件），这个链接直接指向你当前项目的源代码目录。</p>
<p>这样做的好处是显而易见的：你的项目源代码和虚拟环境中的“已安装版本”实现了实时同步。你在编辑器里对任何 <code>.py</code> 文件做的修改，保存后会<strong>立即生效</strong>，无需任何重新安装的步骤。这极大地简化了“修改 - 运行 - 调试”的开发循环，是现代 Python 开发的必备技巧。</p>
<p>通过 <code>pyproject.toml</code> 和可编辑模式，我们不仅拥有了清晰的依赖管理，还获得了高效的开发体验。接下来，让我们通过一个真实的项目，来看看 <code>pyproject.toml</code> 在实战中是如何发挥作用的。</p>
<h2 id="解析splitter-项目的-pyprojecttoml">解析<code>splitter</code> 项目的 <code>pyproject.toml</code></h2>
<p>以我参与的 <a class="link" href="https://gitee.com/openeuler/splitter"  target="_blank" rel="noopener"
    >splitter</a> 项目为例，解析它的 <code>pyproject.toml</code> 文件，看看它是如何将项目的所有配置信息尽收囊中的。</p>
<p>以下是 <code>splitter</code> 项目中 <code>pyproject.toml</code> 文件的核心内容，为便于说明，已做适当简化：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml of splitter project</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;splitter&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span> <span class="c"># Assuming a version for clarity</span>
</span></span><span class="line"><span class="cl"><span class="nx">description</span> <span class="p">=</span> <span class="s2">&#34;A tool for splitting software packages into smaller components.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">authors</span> <span class="p">=</span> <span class="p">[{</span><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;openEuler Cloudnative SIG&#34;</span><span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="nx">readme</span> <span class="p">=</span> <span class="s2">&#34;README.md&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires-python</span> <span class="p">=</span> <span class="s2">&#34;&gt;=3.7&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">license</span> <span class="p">=</span> <span class="p">{</span><span class="nx">text</span> <span class="p">=</span> <span class="s2">&#34;MulanPSL-2.0&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;PyYAML&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;click&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;packaging&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;jinja2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">urls</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">Homepage</span> <span class="p">=</span> <span class="s2">&#34;https://gitee.com/openeuler/splitter&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">scripts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">splitter</span> <span class="p">=</span> <span class="s2">&#34;tools.main:main&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">tool</span><span class="p">.</span><span class="nx">setuptools</span><span class="p">.</span><span class="nx">packages</span><span class="p">.</span><span class="nx">find</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">where</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;.&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">exclude</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;tests&#34;</span><span class="p">,</span> <span class="s2">&#34;docs&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，让我们逐段来剖析这个文件。</p>
<h3 id="build-system"><code>[build-system]</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这是 <code>pyproject.toml</code> 的“入口”，也是遵循 PEP 518 规范的体现。它告诉 <code>pip</code> 这样的构建工具：在构建本项目之前，请确保你的环境中安装了 <code>setuptools</code> 和 <code>wheel</code> 这两个包，因为它们是我需要的构建工具。然后，请使用 <code>setuptools.build_meta</code> 这个入口点来执行实际的构建操作。</p>
<p>这一段配置，实现了项目构建依赖与项目本身运行依赖的解耦。</p>
<h3 id="project"><code>[project]</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;splitter&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">description</span> <span class="p">=</span> <span class="s2">&#34;...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">authors</span> <span class="p">=</span> <span class="p">[...]</span>
</span></span><span class="line"><span class="cl"><span class="nx">readme</span> <span class="p">=</span> <span class="s2">&#34;README.md&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires-python</span> <span class="p">=</span> <span class="s2">&#34;&gt;=3.7&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">license</span> <span class="p">=</span> <span class="p">{</span><span class="nx">text</span> <span class="p">=</span> <span class="s2">&#34;MulanPSL-2.0&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;PyYAML&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;click&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;packaging&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;jinja2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这部分是项目的核心元数据，遵循 PEP 621 规范。</p>
<ul>
<li>
<p><code>name</code>, <code>version</code>, <code>description</code>, <code>authors</code>：这些都是项目的基本信息，会被打包到软件中，并在 PyPI 等包索引网站上展示。</p>
</li>
<li>
<p><code>requires-python</code>：这是一个非常重要的字段，它声明了项目运行所需的最低 Python 版本。如果用户尝试在一个不兼容的 Python 版本（如 Python 3.6）上安装，<code>pip</code> 会直接报错并终止安装，避免了后续可能出现的各种运行时错误。</p>
</li>
<li>
<p><code>dependencies</code>：这里是项目的依赖。它清晰地列出了 <code>splitter</code> 运行所必需的<strong>直接依赖项</strong>。当执行 <code>pip install .</code> 时，<code>pip</code> 会负责安装 <code>PyYAML</code>, <code>click</code>, <code>packaging</code>, <code>jinja2</code> 以及它们各自的所有子依赖，而我们无需关心这些复杂的依赖链。</p>
</li>
</ul>
<h3 id="projectscripts"><code>[project.scripts]</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">scripts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">splitter</span> <span class="p">=</span> <span class="s2">&#34;tools.main:main&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这一行配置，定义了一个名为 <code>splitter</code> 的命令行入口。</p>
<p>当项目被安装后，<code>pip</code> 会在虚拟环境的 <code>bin/</code> 目录下创建一个名为 <code>splitter</code> 的可执行文件。当我们运行这个命令时，系统会自动调用 <code>tools/main.py</code> 文件中的 <code>main()</code> 函数。这使得一个复杂的 Python 项目可以像一个普通的系统命令一样被调用，极大地提升了用户体验。</p>
<h3 id="toolsetuptoolspackagesfind"><code>[tool.setuptools.packages.find]</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">tool</span><span class="p">.</span><span class="nx">setuptools</span><span class="p">.</span><span class="nx">packages</span><span class="p">.</span><span class="nx">find</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">where</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;.&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">exclude</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;tests&#34;</span><span class="p">,</span> <span class="s2">&#34;docs&#34;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>前缀为 <code>[tool.*]</code> 的表是为各种第三方工具预留的配置空间。这里，我们为构建后端 <code>setuptools</code> 提供了配置。</p>
<p><code>packages.find</code> 指示 <code>setuptools</code> 自动发现项目中的所有 Python 包。<code>where = [&quot;.&quot;]</code> 告诉它从当前根目录开始查找，而 <code>exclude = [&quot;tests&quot;, &quot;docs&quot;]</code> 则明确排除了测试代码和文档目录，确保它们不会被打包到最终发布的应用中。</p>
<p>通过这个真实的例子，我们可以看到 <code>pyproject.toml</code> 如何将项目的构建信息、元数据、运行依赖、命令行入口和工具配置，全部地组织在了一起，让 Python 项目的结构变得清晰和标准化。</p>
<h2 id="poetry-uv-pdm-等高级管理工具">Poetry, UV, PDM 等高级管理工具</h2>
<p><code>venv</code> + <code>pyproject.toml</code> + <code>pip</code> 的组合，已经构建起了一个相当稳固和规范的项目管理框架，它解决了依赖隔离和声明的核心问题。然而，这个工作流依然存在一些需要开发者手动操作的环节：</p>
<ul>
<li>
<p><strong>手动管理虚拟环境</strong>：你需要记得先创建，再激活。</p>
</li>
<li>
<p><strong>手动编辑依赖文件</strong>：添加或移除依赖时，你需要手动去编辑 <code>pyproject.toml</code> 文件。</p>
</li>
</ul>
<p>有没有一种工具，能将这些步骤完全自动化呢？当然有。这便是 <code>Poetry</code>, <code>PDM</code> 以及新秀 <code>uv</code> 这类高级项目管理工具的使命所在。</p>
<h3 id="新一代高级管理工具">新一代高级管理工具</h3>
<p>这些工具并非要推翻 <code>venv</code> 和 <code>pyproject.toml</code>，恰恰相反，它们是建立在这些官方标准之上的<strong>高级封装</strong>和<strong>工作流引擎</strong>。它们的核心理念可以概括为：</p>
<ol>
<li>
<p><strong>自动化环境管理</strong>：你不再需要关心 <code>venv</code> 的创建和激活，工具会自动为你处理好一切。</p>
</li>
<li>
<p><strong>命令式依赖操作</strong>：通过简单的命令（如 <code>add</code>, <code>remove</code>）来管理依赖，工具会自动更新 <code>pyproject.toml</code> 文件。</p>
</li>
<li>
<p><strong>确定性构建</strong>：通过生成一个精确的 <code>lock</code> 文件（如 <code>poetry.lock</code>, <code>pdm.lock</code>, <code>uv.lock</code>），锁定项目中<strong>所有</strong>依赖（包括直接和间接依赖）的精确版本。这确保了任何人在任何时间、任何机器上都能构建出完全一致的运行环境。</p>
</li>
<li>
<p><strong>集成化体验</strong>：将依赖管理、环境管理、打包、发布等功能集成到一套统一的命令行接口中，提供“一站式”的解决方案。</p>
</li>
</ol>
<h3 id="以-uv-为例的现代化工作流">以 <code>uv</code> 为例的现代化工作流</h3>
<p><code>uv</code> 是由 <code>ruff</code> 的作者开发的最新一代 Python 打包工具，它用 Rust 编写。让我们以 <code>uv</code> 为例，体验一下现代化的工作流是多么流畅。</p>
<p><em>假设你已经通过 <code>pip install uv</code> 安装了它。</em></p>
<p><strong>开发者 A (项目创建者)</strong></p>
<ol>
<li><strong>初始化项目</strong></li>
</ol>
<p>在一个空目录中，我们不再需要手动创建任何文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># uv 会引导你创建 pyproject.toml 文件</span>
</span></span><span class="line"><span class="cl">uv init
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><strong>添加依赖</strong></li>
</ol>
<p>现在，想给项目添加 <code>flask</code> 依赖？告别手动编辑，一条命令即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">uv add flask
</span></span></code></pre></td></tr></table>
</div>
</div><p>这条命令，<code>uv</code> 在背后为你完成了一系列操作：</p>
<ul>
<li>
<p><strong>检查并创建虚拟环境</strong>：它会自动检测当前目录下是否存在 <code>.venv</code>，如果没有，就为你创建一个。</p>
</li>
<li>
<p><strong>修改 <code>pyproject.toml</code></strong>：自动将 <code>flask</code> 添加到 <code>[project.dependencies]</code> 列表中。</p>
</li>
<li>
<p><strong>解析依赖并安装</strong>：解析 <code>flask</code> 的所有依赖树，并将它们全部安装到虚拟环境中。</p>
</li>
<li>
<p><strong>生成锁文件</strong>：创建一个 <code>uv.lock</code> 文件，里面精确记录了本次安装的所有包（包括间接依赖）的版本号和哈希值，锁定了当前环境的状态。</p>
</li>
</ul>
<p><strong>开发者 B (协作者)</strong></p>
<ol>
<li><strong>同步环境</strong></li>
</ol>
<p>当开发者 B 从 GitHub 克隆了项目后，他不需要再去研究 <code>pyproject.toml</code> 或执行复杂的安装命令。他只需要：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">uv sync
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>uv</code> 会读取 <code>uv.lock</code> 文件，然后下载并安装所有被锁定的包，为他创建一个与开发者 A <strong>完全一致</strong>的虚拟环境。</p>
<p><strong>日常开发与执行</strong></p>
<p>在开发过程中，你甚至不需要手动 <code>source .venv/bin/activate</code> 来激活环境。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># uv 会自动在项目的虚拟环境中执行 python main.py</span>
</span></span><span class="line"><span class="cl">uv run python main.py
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>uv run</code> 命令会自动寻找并使用当前项目的虚拟环境来执行后续的命令，让你的操作更加简洁。</p>
<p>通过 <code>uv</code> 的演示，我们可以看到，现代化的项目管理工具将开发者从繁琐的、易出错的手动操作中彻底解放出来。它们通过自动化和确定性的机制，让依赖和环境管理变得简单、可靠且高效。</p>
<p>好的，这是最后一章的总结部分。它将对全文进行回顾，并提炼出具体、可操作的最佳实践，为读者画上一个圆满的句号。</p>
<h2 id="构建你的现代化-python-工作流">构建你的现代化 Python 工作流</h2>
<p>无论你正在开始一个新项目，还是打算重构一个旧项目，请遵循以下三个原则。</p>
<p><strong>1. 隔离是基础：始终为你的项目创建虚拟环境</strong></p>
<p>这是现代化项目管理的基石，也是最不应该被忽略的一步。为每个项目创建一个独立的虚拟环境，可以从根源上杜绝依赖冲突和全局环境污染。像 <code>uv</code>, <code>Poetry</code>, <code>PDM</code> 这类工具已经将这一步完全自动化，你甚至无需再手动操作。如果你仍在使用原生工具，请务必将 <code>python -m venv .venv</code> 作为你开启任何新项目的第一条命令。</p>
<p><strong>2. 声明是核心：拥抱 <code>pyproject.toml</code>，告别 <code>requirements.txt</code></strong></p>
<p><code>pyproject.toml</code> 是 Python 项目的未来。请将它作为你项目配置的唯一真实来源。</p>
<ul>
<li>
<p><strong>只声明直接依赖</strong>：在 <code>[project.dependencies]</code> 中，只列出你的项目代码直接 <code>import</code> 的那些库。这能让你的项目依赖关系保持最大程度的清晰和可维护性。</p>
</li>
<li>
<p><strong>统一所有配置</strong>：将代码检查工具 (linter)、格式化工具 (formatter)、测试框架等所有工具的配置，都迁移到 <code>pyproject.toml</code> 的 <code>[tool.*]</code> 表中，让项目根目录保持整洁。</p>
</li>
</ul>
<p><strong>3. 工具是利器：选择一个现代化的管理工具</strong></p>
<p>虽然你可以手动维护 <code>pyproject.toml</code> 并结合 <code>pip</code> 使用，但一个现代化的项目管理工具能极大地提升你的生产力。</p>
<ul>
<li>
<p><strong>对于新项目</strong>：强烈推荐直接使用 <code>uv</code> 或 <code>Poetry</code>。它们提供的 <code>add</code>, <code>remove</code>, <code>sync</code>, <code>run</code> 等命令，将依赖管理和环境操作的体验提升到了一个全新的高度。它们带来的<strong>确定性构建</strong>（通过 lock 文件）对于团队协作和持续集成（CI/CD）至关重要。</p>
</li>
<li>
<p><strong>对于现有项目</strong>：迁移到这些工具也比你想象的要简单。大多数工具都提供了从 <code>requirements.txt</code> 导入依赖的功能，可以帮助你平滑过渡。</p>
</li>
</ul>
<h2 id="写在最后">写在最后</h2>
<p>希望这篇指南能够帮助你理清 Python 项目管理的脉络，并为你提供一套清晰、可行的实践方案。现在就动手，为你的下一个 Python 项目开启一个现代化的新起点吧！</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/python/">Python</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/python-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5uv-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">
        
        

        <div class="article-details">
            <h2 class="article-title">Python 项目管理最佳实践：uv 使用指南</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-python-%E4%B8%8E-pip/">
        
        

        <div class="article-details">
            <h2 class="article-title">深入理解 Python 与 pip</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%8F%AD%E7%A7%98-python-%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/">
        
        

        <div class="article-details">
            <h2 class="article-title">揭秘 Python 环境管理的底层实现</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/python-%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE/">
        
        

        <div class="article-details">
            <h2 class="article-title">Python 虚拟环境管理工具选择建议</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82-python-%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86%E7%A5%9E%E5%99%A8-conda/">
        
        

        <div class="article-details">
            <h2 class="article-title">一文彻底搞懂 Python 环境管理神器 Conda</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mahaoliang-tech" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2025 mahaoliang.tech
    </section>
    
    <section class="powerby">
        
            <a target="_blank" href= "https://beian.miit.gov.cn">粤 ICP 备 2022085181 号 -2</a> <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.19.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
