[{"content":"As developers, we often need to connect to remote Linux servers via SSH for development. Tools like VS Code\u0026rsquo;s Remote-SSH plugin make it feel almost as if we\u0026rsquo;re working on a local machine. However, a common pain point arises: SSH key management.\nWe want to:\nUse an SSH key to log in to the server and push code to a Git repository (like GitHub). Sign every Git commit to verify its origin. Most importantly: avoid copying any files containing private keys to the remote server to prevent key compromise if the server is breached. Fortunately, we can perfectly solve this problem using the 1Password built-in SSH Agent and SSH Agent Forwarding. This article will guide you step-by-step through the configuration to achieve a secure and seamless remote development workflow.\nIntroduction to Core Concepts Before we begin, let\u0026rsquo;s briefly understand a few key concepts:\nSSH Agent: Think of it as a temporary key manager. At the beginning of a session, you can load your decrypted private key into the agent. Subsequently, any SSH operation requiring that key will request it from the agent, saving you from repeatedly entering your password. When you close your terminal session, the agent also terminates, and the key is securely cleared.\n1Password SSH Agent: 1Password 8 and later include a powerful built-in SSH Agent. It securely stores your SSH private keys in your 1Password vault and interacts with your system through a secure socket file. This means your private keys never exist in plaintext on your disk, and all usage requests must be authorized through 1Password (e.g., via Touch ID or your master password).\nSSH Agent Forwarding: This is a very powerful SSH feature. When you SSH from your local computer to a remote server, it can establish a secure channel that \u0026ldquo;forwards\u0026rdquo; requests for key authentication from the remote server back to your local machine, to be handled by your local SSH Agent. This way, the remote server itself doesn\u0026rsquo;t need to store any private keys at all.\nOur Target Workflow On our local machine, 1Password manages our SSH private keys. We connect to the remote server via VS Code Remote-SSH or the terminal, with Agent Forwarding enabled. On the remote server, when we run git push, the authentication request is forwarded back to the local machine and handled by 1Password. On the remote server, when we run git commit, the signing request is also forwarded back to the local machine for authorization by 1Password. Configuration Process Prerequisites You have installed the 1Password 8 or newer desktop client. Your SSH key is already created and saved in the SSH Keys category in 1Password. Step 1: Configure Your Local Machine to Use 1Password for SSH First, we need to tell our local SSH client to hand over all key-related requests to 1Password.\nEnable the SSH Agent in 1Password\nOpen the 1Password desktop app. Go to Settings -\u0026gt; Developer. Check the Use SSH agent box. Configure Your Local SSH Config File (~/.ssh/config)\nAccording to 1Password\u0026rsquo;s official documentation, we have two ways to tell the SSH client where the agent is: the IdentityAgent directive and the SSH_AUTH_SOCK environment variable. Using IdentityAgent is recommended.\nEdit the ~/.ssh/config file on your local machine (create it if it doesn\u0026rsquo;t exist). Add the following content to the top of the file:\n1 2 3 # Tell all SSH connections (*) to use the 1Password Agent Host * IdentityAgent \u0026#34;~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock\u0026#34; Verify the Configuration\nIn the terminal on your local machine, run the following command:\n1 ssh-add -l If the configuration is successful, it will list the public key fingerprints of all the SSH keys stored in your 1Password. This proves that your local SSH client has successfully connected with 1Password.\nStep 2: Configure the Connection to Enable Agent Forwarding Now, we need to enable the Agent Forwarding feature when connecting to a specific remote server. The best practice is still to modify the ~/.ssh/config file.\nContinue editing the ~/.ssh/config file on your local machine and add a dedicated configuration block for your server:\n1 2 3 4 5 # Give your remote server an alias for easy connection Host my-dev-server HostName \u0026lt;your_server_ip_or_domain\u0026gt; User your_username ForwardAgent yes # \u0026lt;-- The key! Enables Agent Forwarding Host my-dev-server: This is the shortcut alias you\u0026rsquo;ll use to connect. HostName: The server\u0026rsquo;s actual IP address or domain name. User: Your username on the server. ForwardAgent yes: This is the switch that turns on Agent Forwarding. Now, you can connect via ssh my-dev-server or connect directly to my-dev-server in VS Code Remote-SSH, and the forwarding feature will be enabled automatically.\nStep 3: Configure Git on the Remote Server This is the final and most crucial step. We need to tell Git on the remote server how to use our forwarded SSH agent for commit signing.\nConnect and Verify Forwarding\nFirst, connect to your remote server:\n1 ssh my-dev-server Once connected, run the verification command again in the terminal on the remote server:\n1 2 3 4 5 6 7 8 9 ssh-add -l ``` If Agent Forwarding is working correctly, the output here should be **exactly the same** as the output on your **local machine**! If you see the error \u0026#34;Could not open a connection to your authentication agent.\u0026#34;, check your SSH service configuration to ensure `AllowAgentForwarding yes` is enabled. Open the `/etc/ssh/sshd_config` file with an editor like vim and find the `AllowAgentForwarding` option, setting it to `yes`: ```bash AllowAgentForwarding yes Save the file and restart the SSH service to apply the changes:\n1 systemctl restart sshd Connect to your remote server again and run ssh-add -l to confirm that Agent Forwarding is working correctly.\nGet the Public Key for Signing\nGit needs to know which specific key to use for signing. We need to provide the full public key string as an identifier. On the remote server, run:\n1 ssh-add -L This command lists the full public keys for all keys in the agent. Copy the line for the key you want to use for signing. It will look something like this: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICxxxxxxxxxxxxxxxxxxxx your-key-comment\nConfigure the .gitconfig on the Remote Server\nNow, edit the ~/.gitconfig file on your remote server. Update your existing configuration as follows:\n1 2 3 4 5 6 7 8 9 10 11 12 13 [user] email = your.email@example.com name = Your Name # Set the value of signingkey to the full public key string you copied in the previous step signingkey = ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICxxxxxxxxxxxxxxxxxxxx your-key-comment [gpg] # Tell Git to use the ssh program for signing format = ssh [commit] # Make all commits signed by default gpgsign = true The most important change is signingkey. We are no longer using a file path but providing the public key itself. This allows Git to directly request the forwarded agent to use this specific key for signing.\nAll Set! Let\u0026rsquo;s Test It Out Everything is ready! On the remote server, navigate to any of your git projects and try creating a new commit:\n1 git commit --allow-empty -m \u0026#34;Test: Signed commit with 1Password Agent Forwarding\u0026#34; At this moment, something magical happens: an authorization request from 1Password will pop up on your local machine, notifying you that an application is requesting to use your SSH key. After you authorize it with Touch ID or your master password, the git commit command on the remote server completes instantly.\nFinally, check your commit log:\n1 git log --show-signature -1 You will see output similar to the following, where Good signature clearly tells you that this commit has been successfully signed by your key!\n1 2 3 4 5 6 commit \u0026lt;commit_hash\u0026gt; (HEAD -\u0026gt; main) Good \u0026#34;git\u0026#34; signature for your.email@example.com with ED25519 key SHA256:GKaU0ZCgehQ73X... Author: Your Name \u0026lt;your.email@example.com\u0026gt; Date: ... Test: Signed commit with 1Password Agent Forwarding Summary The diagram below illustrates the core workflow for signing remote Git commits using 1Password and SSH Agent Forwarding.\nDiagram Components\nLocal Machine (Local)\nDeveloper: The initiator of the action. 1Password SSH Agent: Securely stores the private key and handles all signing requests. SSH Client: The local SSH program, configured to use the 1Password Agent and enable forwarding. Remote Server (Remote)\nRemote Terminal: The developer\u0026rsquo;s workspace on the server. Git: The version control tool, configured to use SSH for signing. SSH Daemon: The SSH service on the server, responsible for establishing the secure connection and forwarding requests. Detailed Interaction Flow\nInitiate Commit: The developer executes the git commit command in the Remote Terminal. Request Signature: Based on its configuration, Git requests a signature using an SSH key from the SSH service. Forward Request: The remote server\u0026rsquo;s SSH Daemon forwards the signing request through the encrypted SSH tunnel back to the local machine\u0026rsquo;s SSH Client. This is the core of Agent Forwarding. Request 1Password: The local SSH Client passes the request to the 1Password SSH Agent. Request User Authorization: 1Password displays a prompt on the local machine, asking the Developer for authorization. User Authorizes: The Developer authenticates locally (e.g., with Touch ID or master password). Return Signature: Upon successful authorization, 1Password generates the signature and returns it to the local SSH Client. Return Signature to Remote: The signature is securely transmitted back through the SSH tunnel to the remote server\u0026rsquo;s SSH Daemon. Complete Commit: The remote Git process receives the valid signature, successfully creates the commit, and displays a success message in the Remote Terminal. By following the steps above, we have built a remote development workflow that is both secure and convenient. Your private key always remains safely in your local 1Password vault, while all Git operations on the remote server (authentication and signing) can use it seamlessly and securely. This not only enhances security but also greatly simplifies key management in multi-server environments, allowing you to focus more on coding itself.\n","date":"2025-08-05T21:05:21+08:00","permalink":"https://mahaoliang.tech/en/p/enhancing-your-remote-development-experience-with-1password-and-ssh-agent-forwarding/","title":"Enhancing Your Remote Development Experience with 1Password and SSH Agent Forwarding"}]